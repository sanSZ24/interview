## HTTP协议

<h5>基本概念

- Http: 超文本传输协议， 是一个在计算机世界里专门在**两点**之间**传输**文字、图片、音频、视频等**超文本**数据的**约定和规范**。



- 常见状态码:
  - 1xx: 类状态码属于**提示信息**，是协议处理中的一种中间状态，实际用到的比较少。
  - 2xx: 表示服务器成功的处理了客户端的请求，200表示正常处理，204与200几乎相同，但响应头没有数据。
  - 3xx: 表示客户端请求的资源发生了变动，需要客户端重定向请求资源。
  - 4xx: 表示客户端发送的报文有误，服务器无法处理。400表示请求的报文有误，403是服务器禁止访问资源，404等。
  - 5xx: 是服务器处理时发生了问题。



- 常见字段
  - *Host*：客户端发送请求时，用来指定服务器的域名。
  - *Content-Length*: 服务器在返回数据时，会有 `Content-Length` 字段，表明本次回应的数据长度。
  - *Connection*: 常用于客户端要求服务器使用「HTTP 长连接」机制，以便其他请求复用。
  - *Content-Type*: 用于服务器回应时，告诉客户端，本次数据是什么格式。
  - *Content-Encoding*: 说明数据的压缩方法。表示服务器返回的数据使用了什么压缩格式。



- GET与POST

  - GET 的语义是从服务器获取指定的资源，GET 请求的参数位置一般是写在 URL 中。

  - POST 的语义是根据请求负荷（报文body）对指定的资源做出处理。POST 请求携带数据的位置一般是写在报文 body 中。

    > GET是**只读**，POST是**新增数据或提交数据**。GET是安全的、幂等的、可被缓存的，POST是不安全的、不幂等、不可缓存。



- HTTP 传输的内容都是明文的，要避免传输过程中数据被窃取，就要使用 HTTPS 协议，这样所有 HTTP 的数据都会被加密传输。



<h5>HTTP缓存技术

- 强制缓存: 只要浏览器判断缓存没有过期，则直接使用浏览器的本地缓存，决定是否使用缓存的主动性在于浏览器这边。
- 协商缓存: 当我们在浏览器使用开发者工具的时候，你可能会看到过某些请求的响应码是 `304`，这个是告诉浏览器可以使用本地缓存的资源，通常这种**通过服务端告知客户端是否可以使用缓存的方式被称为协商缓存**。



<h5>HTTP/1.1

- 优点：简单、灵活和易于扩展、应用广泛和跨平台。
- 缺点：无状态、明文传输、不安全。
- 性能：
  - **长连接**：只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。
  - **管道网络传输**：可在同一个 TCP 连接里面，客户端可以发起多个请求，只要第一个请求发出去了，不必等其回来，就可以发第二个请求出去，可以**减少整体的响应时间**。
  - **队头阻塞**：当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的所有请求也一同被阻塞了，会招致客户端一直请求不到数据。



<h5>HTTP与HTTPS

- 区别: 
  - http是明文传输，存在安全风险，https是加密传输，解决了安全缺陷。
  - http只需要三次握手后就可以建立连接，https不仅需要三次握手，还需要SSL/TLS握手才可以进行加密传输。
  - http默认端口为80，https默认端口号为443。
  - https需要申请数字证书(SSL)，来保证服务器的身份是可信的。



- http协议存在着下列风险：窃听风险、篡改风险、冒充风险。https在http与tcp之间增加了ssl/tls协议解决上述风险。

  - 信息加密: **混合加密**的方式实现信息的**机密性**，解决了窃听的风险。
  - 校验机制: **摘要算法**的方式来实现**完整性**，它能够为数据生成独一无二的「指纹」，指纹用于校验数据的完整性，解决了篡改的风险。
  - 身份证书: 将服务器公钥放入到**数字证书**中，解决了冒充的风险。

  

- https建立连接

  - SSL/TLS 协议基本流程：

    - 客户端向服务器索要并验证服务器的公钥。
    - 双方协商生产「会话秘钥」。
    - 双方采用「会话秘钥」进行加密通信。

    > TLS 的「握手阶段」涉及**四次**通信，使用不同的密钥交换算法，TLS 握手流程也会不一样的，现在常用的密钥交换算法有两种：[RSA 算法 (opens new window)](https://xiaolincoding.com/network/2_http/https_rsa.html)和 [ECDHE 算法 (opens new window)](https://xiaolincoding.com/network/2_http/https_ecdhe.html)。

  - TLS 在实现上分为**握手协议**和**记录协议**两层

    - TLS 握手协议就是我们前面说的 TLS 四次握手的过程，负责协商加密算法和生成对称密钥，后续用此密钥来保护应用程序数据（即 HTTP 数据）；
    - TLS 记录协议负责保护应用程序数据并验证其完整性和来源，所以对 HTTP 数据加密是使用记录协议；



- https一定安全可靠吗？
  - 如果是中间人的情况，是属于用户操作不当，信任了中间人网站，从而导致中间人获取了https里的数据，https协议本身是安全的。被卡了逻辑bug。



<h5>优化Http /1.1

- 避免发送http请求
  - 缓存

- 减少http请求次数
  - 减少重定向次数: 将重定向请求交给代理服务器完成。
  - 合并请求:合并资源，以一个大资源的请求替换多个小资源的请求。
  - 延迟发送请求: 当前不需要的资源，我们没必要也获取过来，于是可以通过**按需获取**的方式，来减少第一时间的 HTTP 请求次数。
- 减少http响应数据的大小: 对响应资源进行压缩。
  - 无损压缩: 资源经过压缩后，信息不被破坏，还能完全恢复到压缩前的原样，适合用在文本文件、程序可执行文件、程序源代码。
  - 有损压缩: 经过压缩，解压的数据会与原始数据不同但是非常接近。



<h5>优化https

- HTTPS 相比 HTTP 协议多一个 TLS 协议握手过程，**目的是为了通过非对称加密握手协商或者交换出对称加密密钥**，这个过程最长可以花费掉 2 RTT，接着后续传输的应用数据都得使用对称加密密钥来加密/解密。



- 硬件优化: **HTTPS 协议是计算密集型，而不是 I/O 密集型**，所以不能把钱花在网卡、硬盘等地方，应该花在 CPU 上
- 软件优化: 软件的优化方向可以分层两种，一个是**软件升级**，一个是**协议优化**。
- 会话复用: 把首次 TLS 握手协商的对称加密密钥缓存起来，待下次需要建立 HTTPS 连接时，直接「复用」这个密钥
- 协议优化: 协议的优化就是对「密钥交换过程」进行优化。
- 证书优化:
  - 证书传输：减少证书的大小，**对于服务器的证书应该选择椭圆曲线（ECDSA）证书，而不是 RSA 证书，因为在相同安全强度下， ECC 密钥长度比 RSA 短的多**。
  - 证书验证优化

