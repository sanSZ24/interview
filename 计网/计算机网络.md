---
typora-root-url: ./
---

## 计算机网络

##### 基础

- TCP/IP网络模型: 是指能够在多个不同网络间实现信息传输的协议簇。各层的所有协议被称为协议栈，因特网的协议栈主要有五层。

  - 应用层: 包含HTTP、FTP、SMTP等协议。应用层协议分布于多个端系统之上，当两个不同设备的应用需要通信的时候，应用就把应用数据传给下一层，也就是传输层。应用层是不用去关心数据是如何传输。

  - 传输层: 包含TCP、UDP协议。应用层的数据包会传给传输层，**传输层**（*Transport Layer*）是为应用层提供网络支持的。通常会将需要传输的数据拆分为多个包，当设备作为接收方时，传输层则要负责把数据包传给应用，但是一台设备上可能会有很多应用在接收或者传输数据，因此需要用一个编号将应用区分开来，这个编号就是**端口**。

    > TCP 的全称叫传输控制协议（*Transmission Control Protocol*），大部分应用使用的正是 TCP 传输层协议，比如 HTTP 应用层协议。TCP 相比 UDP 多了很多特性，比如流量控制、超时重传、拥塞控制等，这些都是为了保证数据包能可靠地传输给对方。
    >
    > UDP 相对来说就很简单，简单到只负责发送数据包，不保证数据包是否能抵达对方，但它实时性相对更好，传输效率也高。

  - 网络层: 负责数据的实际的传输功能，将包从一台主机发送到另一台主机。包含**IP**协议。

    > 于 IPv4 协议， IP 地址共 32 位，分成了四段（比如，192.168.100.1），每段是 8 位。将 IP 地址分成两种意义：
    >
    > - 一个是**网络号**，负责标识该 IP 地址是属于哪个「子网」的；
    > - 一个是**主机号**，负责标识同一「子网」下的不同主机；
    >
    > 使用子网掩码与主机号进行**按位与运算**，就可以得到网络号。
    >
    > 除了寻址能力， IP 协议还有另一个重要的能力就是**路由**。**IP 协议的寻址作用是告诉我们去往下一个目的地该朝哪个方向走，路由则是根据「下一个目的地」选择路径。寻址更像在导航，路由更像在操作方向盘**。

  - 链路层：将分组移到下一个节点需要依靠链路层服务。在 IP 头部的前面加上 MAC 头部，并封装成数据帧（Data frame）发送到网络上。常用的技术有**以太网**和**wifi**。

  - 物理层：将帧中的数据从一个节点移动到下一个节点。



- URL各个部分的含义: 协议//服务器主机(域名或主机的IP): 端口/目录名/文件名

  

- 查询服务器域名对应的 IP 地址，先在本地缓存中查找，没有就一级一级向上查找。

  - 通过 DNS 获取到 IP 后，应用程序通过调用 Socket 库，来委托协议栈工作。协议栈的上半部分有两块，分别是负责收发数据的 TCP 和 UDP 协议，这两个传输协议会接受应用层的委托执行收发数据的操作。协议栈的下面一半是用 IP 协议控制网络包收发操作，在互联网上传数据时，数据会被切分成一块块的网络包，而将网络包发送给对方的操作就是由 IP 负责的。

    ![](/assets/7.webp)



- 因为**路由器**是基于 IP 设计的，俗称**三层**网络设备，路由器的各个端口都具有 MAC 地址和 IP 地址。

  

- 而**交换机**是基于以太网设计的，俗称**二层**网络设备，交换机的端口不具有 MAC 地址。



- OSI网络模型: 共有七层，由上到下依次为**应用层、表示层、会话层、传输层、网络层、链路层和物理层**。

  > - 表示层，负责把数据转换成兼容另一个系统能识别的格式。
  > - 会话层，负责建立、管理和终止表示层实体之间的通信会话。



<h5>TCP协议

- 报文结构

  ![](/assets/TCP-1723125713958-2.webp)

  > 32bit序号：是这个包的顺序，因为可能会将数据拆分成多个包，包抵达目的地后在按顺序重新排好。
  >
  > 确认号: 目的是确认发出去对方是否有收到。
  >
  > 状态位。例如 `SYN` 是发起一个连接，`ACK` 是回复，`RST` 是重新连接，`FIN` 是结束连接等。TCP 是面向连接的，因而双方要维护连接的状态，这些带状态位的包的发送，会引起双方的状态变更。
  >
  > 窗口大小: TCP 要做**流量控制**，通信双方各声明一个窗口（缓存大小），标识自己当前能够的处理能力。
  >
  > 拥塞控制: 控制发送的速度。

- 三次握手：客户端与服务器建立连接。保证双方都具有发送和接收的能力。

  ![](/assets/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.webp)

  > 第一次握手 TCP客户进程也是先创建传输控制块TCB，然后向服务器发出连接请求报文，这是报文首部中的同部位SYN=1，同时选择一个初始序列号 seq=x ，此时，TCP客户端进程进入了 SYN-SENT 同步已发送状态
  >
  > 第二次握手 TCP服务器收到请求报文后，如果同意连接，则会向客户端发出确认报文。确认报文中应该 ACK=1，SYN=1，确认号是ack=x+1，同时也要为自己初始化一个序列号 seq=y，此时，TCP服务器进程进入了 SYN-RCVD 同步收到状态
  >
  > 第三次握手 TCP客户端收到确认后，还要向服务器给出确认。确认报文的ACK=1，ack=y+1，自己的序列号seq=x+1，此时，TCP连接建立，客户端进入ESTABLISHED已建立连接状态 触发三次握手
  >

- TCP拥塞控制：必须让每一个发送方根据所感知到的网络拥塞程度来限制其向连接方发送的速率。常见算法**慢启动**、**拥塞避免**、**快速恢复**等。



<h5>IP协议

- 报文结构

  ![](/assets/IP.png)

  > 版本号: 规定数据报的IP协议版本(IPv4或IPv6)。
  >
  > 首部长度: 确定IP数据报中数据部分实际从哪里开始。
  >
  > 服务类型: 使不同类型的IP数据报能相互区别。
  >
  > 协议: 指明当前IP数据报的数据部分使用的是什么协议(TCP or UDP)。

- dhcp动态主机配置协议：能够自动将主机连进一个网络的网络相关。